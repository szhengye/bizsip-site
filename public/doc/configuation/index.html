<!DOCTYPE html><html lang="zh-Hans" >

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  
  
  
    <meta name="generator" content="Wowchemy 5.2.0 for Hugo" />
  

  

  
  
  
  
  
    
    
    
  
  

  <meta name="author" content="Nelson Bighetti" />

  
  
  
    
  
  <meta name="description" content="Biz-SIP中间件通过配置来构建系统的介绍。" />

  
  <link rel="alternate" hreflang="zh-Hans" href="http://bizsip.bizmda.com/doc/configuation/" />

  







  




  
  

  
  
  
    <meta name="theme-color" content="#1565c0" />
  

  
  

  
  
  
  
    
    
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/academicons/1.9.0/css/academicons.min.css" integrity="sha512-W4yqoT1+8NLkinBLBZko+dFB2ZbHsYLDdr50VElllRcNt2Q4/GSs6u71UHKxB7S6JEMCp5Ve4xjh3eGQl/HRvg==" crossorigin="anonymous">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css" integrity="sha256-FMvZuGapsJLjouA6k7Eo2lusoAX9i0ShlWFG6qt7SLc=" crossorigin="anonymous">

    
    

    
    
    
      
    
    
      
      
        
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/styles/github.min.css" crossorigin="anonymous" title="hl-light" media="print" onload="this.media='all'">
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/styles/dracula.min.css" crossorigin="anonymous" title="hl-dark" media="print" onload="this.media='all'" disabled>
        
      
    

    
    
    
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/leaflet.min.css" integrity="sha512-1xoFisiGdy9nvho8EgXuXvnpR5GAMSjFwp40gSRE3NwdUdIMIKuPa7bqoUhLD0O/5tPNhteAsE5XyyMi5reQVA==" crossorigin="anonymous" media="print" onload="this.media='all'">
    

    

    
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      
        
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
  

  
  
  

  
  
  
  
  
  <link rel="stylesheet" href="/css/wowchemy.a53ee215eb6dcadd1a125dc8098e4c3e.css" />

  



  

  

  




  
  
  

  

  
    <link rel="manifest" href="/index.webmanifest" />
  

  <link rel="icon" type="image/png" href="/media/icon_hua2ec155b4296a9c9791d015323e16eb5_11927_32x32_fill_lanczos_center_3.png" />
  <link rel="apple-touch-icon" type="image/png" href="/media/icon_hua2ec155b4296a9c9791d015323e16eb5_11927_180x180_fill_lanczos_center_3.png" />

  <link rel="canonical" href="http://bizsip.bizmda.com/doc/configuation/" />

  
  
  
  
  
  
  
  
    
    
  
  
  <meta property="twitter:card" content="summary" />
  
  <meta property="og:site_name" content="Biz-SIP服务整合中间件" />
  <meta property="og:url" content="http://bizsip.bizmda.com/doc/configuation/" />
  <meta property="og:title" content="系统配置 | Biz-SIP服务整合中间件" />
  <meta property="og:description" content="Biz-SIP中间件通过配置来构建系统的介绍。" /><meta property="og:image" content="http://bizsip.bizmda.com/media/icon_hua2ec155b4296a9c9791d015323e16eb5_11927_512x512_fill_lanczos_center_3.png" />
    <meta property="twitter:image" content="http://bizsip.bizmda.com/media/icon_hua2ec155b4296a9c9791d015323e16eb5_11927_512x512_fill_lanczos_center_3.png" /><meta property="og:locale" content="zh-Hans" />
  
    
      <meta
        property="article:published_time"
        content="2021-09-24T00:00:00&#43;00:00"
      />
    
    <meta property="article:modified_time" content="2021-09-24T00:00:00&#43;00:00">
  

  



  

  

  





  <title>系统配置 | Biz-SIP服务整合中间件</title>
</head>


<body id="top" data-spy="scroll" data-offset="70" data-target="#TableOfContents" class="page-wrapper   " data-wc-page-id="98a19aefb7e63d8c59abb79bcfe1c1dd" >

  
  
  
  
  
  
  
  
  
  <script src="/js/wowchemy-init.min.c2ae95842e5b33a787c7b8c567e989a4.js"></script>

  


<aside class="search-modal" id="search">
  <div class="container">
    <section class="search-header">

      <div class="row no-gutters justify-content-between mb-3">
        <div class="col-6">
          <h1>搜索</h1>
        </div>
        <div class="col-6 col-search-close">
          <a class="js-search" href="#" aria-label="Close"><i class="fas fa-times-circle text-muted" aria-hidden="true"></i></a>
        </div>
      </div>

      <div id="search-box">
        
        <input name="q" id="search-query" placeholder="搜索..." autocapitalize="off"
        autocomplete="off" autocorrect="off" spellcheck="false" type="search" class="form-control"
        aria-label="搜索...">
        
      </div>

      
      

      

    </section>
    <section class="section-search-results">

      <div id="search-hits">
        
      </div>

    </section>
  </div>
</aside>



  <div class="page-header">
    












<nav class="navbar navbar-expand-lg navbar-light compensate-for-scrollbar" id="navbar-main">
  <div class="container-xl">

    
    <div class="d-none d-lg-inline-flex">
      <a class="navbar-brand" href="/">Biz-SIP服务整合中间件</a>
    </div>
    

    
    <button type="button" class="navbar-toggler" data-toggle="collapse"
            data-target="#navbar-content" aria-controls="navbar-content" aria-expanded="false" aria-label="切换导航">
    <span><i class="fas fa-bars"></i></span>
    </button>
    

    
    <div class="navbar-brand-mobile-wrapper d-inline-flex d-lg-none">
      <a class="navbar-brand" href="/">Biz-SIP服务整合中间件</a>
    </div>
    

    
    
    <div class="navbar-collapse main-menu-item collapse justify-content-end" id="navbar-content">

      
      <ul class="navbar-nav d-md-inline-flex">
        

        

        
        
        

        

        
        
        
        

        
          
            
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/doc"><span>指南</span></a>
        </li>

        
        

        

        
        
        

        

        
        
        
        

        
          
            
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/post"><span>博客</span></a>
        </li>

        
        

        

        
        
        
          
        

        

        
        
        
        

        
          
            
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/event"><span>更新日志</span></a>
        </li>

        
        

      

        
      </ul>
    </div>

    <ul class="nav-icons navbar-nav flex-row ml-auto d-flex pl-md-2">

      
      
        
      

      
      
      <li class="nav-item">
        <a class="nav-link js-search" href="#" aria-label="搜索"><i class="fas fa-search" aria-hidden="true"></i></a>
      </li>
      

      
      

      
      

    </ul>

  </div>
</nav>


  </div>

  <div class="page-body">
    





<div class="container-fluid docs">
  <div class="row flex-xl-nowrap">
    <div class="col-12 col-md-3 col-xl-2 docs-sidebar">
      <form class="docs-search d-flex align-items-center">
  <button class="btn docs-toggle d-md-none p-0 mr-md-3 w-100" type="button" data-toggle="collapse" data-target="#docs-nav" aria-controls="docs-nav" aria-expanded="false" aria-label="Toggle section navigation">
    <div class="d-flex">
      <span class="d-md-none pl-1 flex-grow-1 text-left overflow-hidden">
        
          Biz-SIP文档
        
      </span>
      <span><i class="fas fa-chevron-down"></i></span>
    </div>
  </button>

  
  <button class="form-control sidebar-search js-search d-none d-md-flex">
    <i class="fas fa-search pr-2"></i>
    <span class="sidebar-search-text">搜索...</span>
    <span class="sidebar-search-shortcut">/</span>
  </button>
  
</form>

<nav class="collapse docs-links" id="docs-nav">
  
  
  
  
  
  

  
  
    

    
      

      


  
    
    
    
    
      
    
    

    
      <ul class="nav docs-sidenav">
        <li class=""><a href="/doc/">Biz-SIP文档</a></li>
    
      


  <li class=""><a href="/doc/quick-start/">快速启动</a></li>



  <li class="active"><a href="/doc/configuation/">系统配置</a></li>



  <li class=""><a href="/doc/development/">系统开发</a></li>



  <li class=""><a href="/doc/interface/">接口规范</a></li>



  <li class=""><a href="/doc/know-how/">运行原理</a></li>



  <li class=""><a href="/doc/extend/">扩展开发</a></li>



  <li class=""><a href="/doc/xbank/">xbank示例项目</a></li>

      
    

    
      </ul>
    

  
</nav>

    </div>

    
    
    <div class="d-none d-xl-block col-xl-2 docs-toc">
      

      <ul class="nav toc-top">
        <li><a href="#" id="back_to_top" class="docs-toc-title">在本页</a></li>
      </ul>

      <nav id="TableOfContents">
  <ul>
    <li><a href="#一概述">一、概述</a></li>
    <li><a href="#二应用层app配置服务编排配置">二、应用层app配置（服务编排配置）</a>
      <ul>
        <li><a href="#1-serviceyml">1. service.yml</a></li>
        <li><a href="#2-service目录">2. service目录</a></li>
        <li><a href="#3-script服务聚合器脚本script">3. Script服务聚合器脚本（*.script）</a></li>
      </ul>
    </li>
    <li><a href="#三适配层source配置服务接入配置">三、适配层source配置（服务接入配置）</a></li>
    <li><a href="#四领域层sink配置服务调用配置">四、领域层sink配置（服务调用配置）</a></li>
    <li><a href="#五适配层source领域层sink-converter配置消息适配">五、适配层source/领域层sink converter配置（消息适配）</a>
      <ul>
        <li><a href="#1-sourceymlsinkyml">1 source.yml/sink.yml</a></li>
        <li><a href="#2-converter目录">2 converter目录</a></li>
        <li><a href="#3-converter介绍">3 Converter介绍</a></li>
        <li><a href="#4-域处理函数">4 域处理函数</a></li>
      </ul>
    </li>
    <li><a href="#六领域层sink-connector配置通讯适配">六、领域层sink connector配置（通讯适配）</a>
      <ul>
        <li><a href="#1-sink-bean-connector">1 Sink-Bean Connector</a></li>
        <li><a href="#2-bean-connector">2 Bean Connector</a></li>
        <li><a href="#3-netty-connector">3 Netty Connector</a></li>
        <li><a href="#4-rabbitmq-connector">4 RabbitMQ Connector</a></li>
      </ul>
    </li>
    <li><a href="#七典型source端适配器介绍与配置">七、典型Source端适配器介绍与配置</a>
      <ul>
        <li><a href="#1-restful服务接入适配器">1 RESTful服务接入适配器</a></li>
        <li><a href="#2-netty-tcp服务接入适配器">2 Netty TCP服务接入适配器</a></li>
      </ul>
    </li>
    <li><a href="#八服务校验规则">八、服务校验规则</a></li>
  </ul>
</nav>

      
    </div>
    

    <main class="col-12 col-md-9 col-xl-8 py-md-3 pl-md-5 docs-content" role="main">

      <article class="article">

        <div class="docs-article-container">
          

          <h1>系统配置</h1>

          <div class="article-style">
            <p>Biz-SIP中间件通过配置来构建系统的介绍。</p>
<h2 id="一概述">一、概述</h2>
<p>Biz-SIP中间件在开发应用时，主要涉及配置文件编写和Java代码开发，系统架构如下所示：
<img src="1632227276119-7bdc5979-8ddf-4498-84db-14fbbf44f203.png" alt="image.png">
上图中蓝色虚框所呈现的部分，就主要是Biz-SIP中间件的配置文件。
Biz-SIP中间件的配置文件，一般都统一存放在配置目录下（由application.yml文件中的bizsip.config-path配置项所约定)，配置目录中的文件如下例所示：</p>
<pre><code>config
|____sink.yml
|____source.yml
|____service.yml
|____converter
| |____server3
| | |____woman.vm
| | |____error.vm
| | |____man.vm
|____service
| |____client1
| | |____error.script
| |____openapi
| | |____sample1.script
| | |____sample5.script
| | |____sample2.script
| | |____sample4.script
|____check-rule
| |____client1
| | |____sample1.yaml

</code></pre>
<p>sink.yml：领域层sink模块的配置文件
source.yml：渠道层source模块的配置文件
service.yml：应用层app聚合服务的的配置文件（非脚本的服务）
service目录：存放所有的应用层app聚合服务编排脚本
converter目录：存放消息转换器converter相关的消息格式转换配置文件
check-rule目录：存放聚合服务校验规则配置文件</p>
<h2 id="二应用层app配置服务编排配置">二、应用层app配置（服务编排配置）</h2>
<h3 id="1-serviceyml">1. service.yml</h3>
<p>定义了所有非脚本类聚合服务的配置参数：</p>
<table>
<thead>
<tr>
<th>配置项</th>
<th>配置说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>[].bizServiceId</td>
<td>聚合服务ID，要全局唯一</td>
</tr>
<tr>
<td>[].type</td>
<td>聚合服务执行调用方式，目前支持“integrator-bean-service”、“bean-service”、“sink-service”三种方式：</td>
</tr>
<tr>
<td>1、integrator-bean-service：该类型执行继承BizServiceInterface接口的SpringBean，并调用约定的doBizService()方法。</td>
<td></td>
</tr>
<tr>
<td>相关参数如下：</td>
<td></td>
</tr>
<tr>
<td>[].className</td>
<td>要执行的SpringBean类名（从BizServiceInterface接口继承）</td>
</tr>
<tr>
<td>2、bean-service：该类型执行约定的SpringBean，调用的方法和参数通过消息传递过来，方法名为消息体JSON数据中的“methodName”域，参数为消息体JSON数据中的“params”域（应为JSON数组）</td>
<td></td>
</tr>
<tr>
<td>[].className</td>
<td>要执行的SpringBean类名，由用户自行定义</td>
</tr>
<tr>
<td>3、sink-service：直接把后端的sink服务，通过此接口通过聚合服务暴露出来</td>
<td></td>
</tr>
<tr>
<td>[].sinkId</td>
<td>该聚合服务所对应的sink id，此聚合服务的数据会直接透传给sink id所对应的Sink后端。</td>
</tr>
</tbody>
</table>
<h4 id="11-integrator-bean-service">1.1 integrator-bean-service</h4>
<p>该类型执行继承BizServiceInterface接口的SpringBean，并调用约定的doBizService()方法，配置参数如下：</p>
<table>
<thead>
<tr>
<th>配置项</th>
<th>配置说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>[].className</td>
<td>要执行的SpringBean类名（从BizServiceInterface接口继承）</td>
</tr>
</tbody>
</table>
<p>service.yml配置例子如下：</p>
<pre><code class="language-yaml">- bizServiceId: /sample/service4
  type: integrator-bean-service
  className: com.bizmda.bizsip.integrator.sample.service.sample.IntegratorService4
</code></pre>
<p>className是服务绑定的类，这个类需要从IntegratorBeanInterface接口继承，接口如下：</p>
<pre><code class="language-java">public interface IntegratorBeanInterface {
    /**
     * 执行聚合服务
     * @param message 传入的消息
     * @return 返回的消息
     */
    public abstract BizMessage&lt;JSONObject&gt; doBizService(BizMessage&lt;JSONObject&gt; message) throws BizException;
}
</code></pre>
<h4 id="12-bean-service">1.2 bean-service</h4>
<p>该类型执行约定的SpringBean，调用的方法和参数通过消息传递过来，方法名为消息体JSON数据中的“methodName”域，参数为消息体JSON数据中的“params”域（应为JSON数组），配置参数如下：</p>
<table>
<thead>
<tr>
<th>配置项</th>
<th>配置说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>[].className</td>
<td>要执行的SpringBean类名，方法由开发者自由定义。</td>
</tr>
</tbody>
</table>
<p>service.yml配置例子如下：</p>
<pre><code class="language-yaml">- bizServiceId: /springbean
  type: bean-service
  className: com.bizmda.bizsip.integrator.sample.service.sample.SinkClientInterface1Impl
</code></pre>
<p>className是服务绑定的类，这个类的接口需要由开发者约定Interface并实现。</p>
<h4 id="13-sink-service">1.3 sink-service</h4>
<p>sink-server是直接把后端的sink服务，通过此接口通过聚合服务暴露出来。</p>
<table>
<thead>
<tr>
<th>配置项</th>
<th>配置说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>[].sinkId</td>
<td>该聚合服务所对应的sink id，此聚合服务的数据会直接透传给sink id所对应的Sink后端。</td>
</tr>
</tbody>
</table>
<p>service.yml配置例子如下：</p>
<pre><code class="language-yaml">- bizServiceId: /sinkService
  type: sink-service
  sinkId: sink1
</code></pre>
<h3 id="2-service目录">2. service目录</h3>
<p>service目录位置配置文件根目录下的/service目录，目录下存放了聚合服务脚本，聚合服务ID为“目录+文件前缀”的方案，例如“service/openapi/sample1.script”文件，对应的聚合服务ID为“openapi/sample1”，文件的后续名表示是支持不同的服务聚合器类型，目前仅支持script服务聚合器（*.script）。</p>
<pre><code>config
|____sink.yml
|____source.yml
|____converter
|____service
| |____client1
| | |____error.script
| |____openapi
| | |____sample1.script
| | |____sample5.script
| | |____sample2.script
| | |____sample4.script
</code></pre>
<h3 id="3-script服务聚合器脚本script">3. Script服务聚合器脚本（*.script）</h3>
<p>Script服务整合器是构建在magic-script脚本解析器基础上的服务编排引擎，通过解释执行service目录下的*.script文件，实现内外部服务整合和编排运行。
service目录下所有的“*.script”文件，都是Script服务整合器脚本。脚本语言采用magic-script（<a href="https://gitee.com/ssssssss-team/magic-script" target="_blank" rel="noopener">https://gitee.com/ssssssss-team/magic-script</a>），这是一款基于JVM的脚本语言。
在Script服务整合器脚本中，主要使用的特殊对象包括：sip对象、log对象等。</p>
<h4 id="31-sip对象">3.1 sip对象</h4>
<blockquote>
<p>sip.callSink(sinkId,inData)</p>
</blockquote>
<p>执行适配器服务调用
参数：</p>
<ul>
<li>sinkId：Sink ID，在sink.yml配置文件中约定。</li>
<li>inData：传送给服务端的数据</li>
</ul>
<p>返回：</p>
<ul>
<li>服务端返回的数据，是BizMessage内部消息类型。</li>
</ul>
<blockquote>
<h5 id="sipdodelayserviceserviceidindatadelaymilliseconds1delaymilliseconds2">sip.doDelayService(serviceId,inData,delayMilliseconds1,delayMilliseconds2&hellip;)</h5>
</blockquote>
<p>执行SAF服务调用
参数：</p>
<ul>
<li>serviceId：SAF服务ID，为配置在config/script中的服务脚本。</li>
<li>inData：传送给服务的数据，在脚本中以“bizmessage”进行存取。</li>
<li>delayMilliseconds&hellip;：延迟毫秒数，可以有多个，分别代表第1次、第2次&hellip;..的服务延迟毫秒数</li>
</ul>
<p>返回：</p>
<ul>
<li>SAF子交易的BizMessage内部消息类型。</li>
</ul>
<blockquote>
<h5 id="sipgetserviceretrycount">sip.getServiceRetryCount()</h5>
</blockquote>
<p>获取SAF服务的当前重试次数
参数：</p>
<ul>
<li>（无）</li>
</ul>
<p>返回：</p>
<ul>
<li>SAF服务的当前重试次数</li>
</ul>
<blockquote>
<h5 id="sipsaveasynccontexttransactionkeycontexttimeout">sip.saveAsyncContext(transactionKey,context,timeout)</h5>
</blockquote>
<p>保存异步服务上下文
参数：</p>
<ul>
<li>transactionKey：异步回调的全局唯一交易索引键</li>
<li>context：注入回调聚合服务的上下文变量</li>
<li>timeout：异步服务超时时间，单位（秒）</li>
</ul>
<p>返回：</p>
<ul>
<li>（无）</li>
</ul>
<blockquote>
<h5 id="siploadasynccontexttransactionkey">sip.loadAsyncContext(transactionKey)</h5>
</blockquote>
<p>保存异步服务上下文
参数：</p>
<ul>
<li>transactionKey：异步回调的全局唯一交易索引键</li>
</ul>
<p>返回：</p>
<ul>
<li>异步服务上下文</li>
</ul>
<h4 id="32-log对象">3.2 log对象</h4>
<pre><code class="language-javascript">// 使用方法与SLF4J完全一致
log.info('Hello');
log.info('Hello {}','MagicAPI');
log.debug('test');
</code></pre>
<h4 id="33-db对象">3.3 db对象</h4>
<blockquote>
<h5 id="select">select</h5>
</blockquote>
<ul>
<li>入参：<code>sql</code>:<code>String</code></li>
<li>返回值：<code>List&lt;Map&lt;String,Object&gt;&gt;</code></li>
<li>函数说明：查询<code>List</code>结果</li>
</ul>
<pre><code>return db.select('select * from sys_user');
</code></pre>
<blockquote>
<h5 id="selectint">selectInt</h5>
</blockquote>
<ul>
<li>入参：<code>sql</code>:<code>String</code></li>
<li>返回值：<code>Integer</code></li>
<li>函数说明：查询<code>int</code>结果</li>
</ul>
<pre><code>//需要保证结果返回一行一列
return db.selectInt('select count(*) from sys_user');
</code></pre>
<blockquote>
<h5 id="selectone">selectOne</h5>
</blockquote>
<ul>
<li>入参：<code>sql</code>:<code>String</code></li>
<li>返回值：<code>Map&lt;String,Object&gt;</code></li>
<li>函数说明：查询单个对象</li>
</ul>
<pre><code>return db.selectOne('select * from sys_user limit 1');
</code></pre>
<blockquote>
<h5 id="selectvalue">selectValue</h5>
</blockquote>
<ul>
<li>入参：<code>sql</code>:<code>String</code></li>
<li>返回值：<code>Object</code></li>
<li>函数说明：查询单个值</li>
</ul>
<pre><code>//需要保证结果返回一行一列 
return db.selectValue('select user_name from sys_user limit 1');
</code></pre>
<blockquote>
<h5 id="page">page</h5>
</blockquote>
<ul>
<li>入参：<code>sql</code>:<code>String</code></li>
<li>入参：<code>limit</code> : <code>long</code> 可省略</li>
<li>入参：<code>offset</code> : <code>long</code> 可省略</li>
<li>返回值：<code>Object</code> 默认返回为Object，如果自定义了分页结果，则返回自定义结果</li>
<li>函数说明：分页查询</li>
</ul>
<pre><code>//需要保证结果返回一行一列 
return db.page('select * from sys_user');
</code></pre>
<blockquote>
<h5 id="update">update</h5>
</blockquote>
<ul>
<li>入参：<code>sql</code>:<code>String</code></li>
<li>返回值：<code>Integer</code></li>
<li>函数说明：执行增删改操作</li>
</ul>
<pre><code>return db.update('delete from sys_user');
</code></pre>
<blockquote>
<h5 id="cache">cache</h5>
</blockquote>
<ul>
<li>入参：<code>cacheName</code>:<code>String</code></li>
<li>入参：<code>ttl</code>:<code>long</code> 缓存有效期，单位毫秒，可省略，默认为配置的值</li>
<li>返回值：<code>db</code> //返回当前实例，即可以链式调用</li>
<li>函数说明：使用缓存</li>
</ul>
<pre><code>//使用缓存名为user的查询
return db.cache('user').select('select * from sys_user');
</code></pre>
<blockquote>
<h5 id="transaction">transaction</h5>
</blockquote>
<ul>
<li>入参：<code>callback</code>:<code>Function</code>，回调函数，可省略</li>
<li>返回值：<code>Object</code></li>
<li>函数说明：开启事务</li>
<li>自动事务</li>
</ul>
<pre><code>var val = db.transaction(()=&gt;{
    var v1 = db.update('...');
    var v2 = db.update('....');
    return v2;
});
return val;
</code></pre>
<ul>
<li>手动开启事务</li>
</ul>
<pre><code>var tx = db.transaction();  //开启事务
try{
    var value = db.update('...');
    db.commit();    // 提交事务
    return value;
}catch(e){
    db.rollback();  // 回滚事务
}
</code></pre>
<h4 id="34-redis对象">3.4 redis对象</h4>
<pre><code class="language-javascript">var data = bizmessage.data;
var value = data.accountNo;
//通过redis.命令名(命令参数,命令参数,.....,命令参数) 进行调用，其中命令名不区分大小写
redis.set('key',value); //调用set命令
//redis.setex('key',10,value);    //调用setex命令
data.accountName = redis.get('key');    //调用get命令
return data;
</code></pre>
<h2 id="三适配层source配置服务接入配置">三、适配层source配置（服务接入配置）</h2>
<p>source.yml定义了客户端适配器的配置参数，并不是所有适配层的接入模块都需要在source.yml中定义，只有用到可配置的消息转换器converter时，才需要定义：</p>
<table>
<thead>
<tr>
<th>配置项</th>
<th>配置说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>[].id</td>
<td>客户端的ID，要全局唯一</td>
</tr>
<tr>
<td>[].converter</td>
<td>参见：消息处理器配置</td>
</tr>
<tr>
<td>[].service</td>
<td>聚合服务相关配置</td>
</tr>
<tr>
<td>[].service-rules[]</td>
<td>聚合服务定位断言规则</td>
</tr>
<tr>
<td>[].service-rules[].predicate</td>
<td>断言规则，返回true选择当前规则rule作为聚合服务ID，空条件为true，支持EL表达式</td>
</tr>
<tr>
<td>[].service-rules[].rule</td>
<td>当前断言规则对应的聚合服务ID，支持EL表达式</td>
</tr>
</tbody>
</table>
<p>例子：</p>
<pre><code class="language-yaml">- id: source1
  converter:
    type: simple-json
  service:
    service-rules:
      - predicate: '#{#data[serviceId] != null}'
        rule: '#{#data[serviceId]}'
      - predicate:
        rule: source1/error
</code></pre>
<h2 id="四领域层sink配置服务调用配置">四、领域层sink配置（服务调用配置）</h2>
<p>sink.yml定义了所有接入的服务端适配器的配置参数：</p>
<table>
<thead>
<tr>
<th>配置项</th>
<th>配置说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>[].id</td>
<td>服务端的ID，要全局唯一</td>
</tr>
<tr>
<td>[].type</td>
<td>服务端适配器调用方式，目前只支持“rest”，为RESTful方式调用</td>
</tr>
<tr>
<td>[].url</td>
<td>服务端适配器调用方式为“rest”方式时，该属性约定RESTful调用的url地址</td>
</tr>
<tr>
<td>[].converter</td>
<td>参见：消息处理器配置</td>
</tr>
<tr>
<td>[].connector</td>
<td>服务端协议处理器相关配置</td>
</tr>
<tr>
<td>[].connector.type</td>
<td>约定服务端协议处理器的类型（具体参见服务端协议处理器配置）</td>
</tr>
<tr>
<td>[].connector.*</td>
<td>约定服务端协议处理器的其它参数（具体参见服务端协议处理器配置）</td>
</tr>
</tbody>
</table>
<p>例子：</p>
<pre><code class="language-yaml">- id: sink1
  type: rest
  url: http://bizsip-sample-sink/sink1
  converter:
    type: simple-json
  connector:
    type: sink-bean
    class-name: com.bizmda.bizsip.sample.sink.controller.CrmServer

- id: sink2
  type: rest
  url: http://bizsip-sample-sink/sink2
  converter:
    type: simple-json
  connector:
    type: sink-bean
    class-name: com.bizmda.bizsip.sample.sink.controller.ActServer
</code></pre>
<h2 id="五适配层source领域层sink-converter配置消息适配">五、适配层source/领域层sink converter配置（消息适配）</h2>
<h3 id="1-sourceymlsinkyml">1 source.yml/sink.yml</h3>
<p>source.yml和sink.yml文件中定义了消息转换器相关配置：</p>
<table>
<thead>
<tr>
<th>配置项</th>
<th>配置说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>[].converter</td>
<td>Source模块/Sink模块的消息格式相关配置</td>
</tr>
<tr>
<td>[].converter.type</td>
<td>Source模块/Sink模块的消息转换类型，目前支持：simple-json、simple-xml、velocity-json、velocity-xml、fixed-length、velocity-split等</td>
</tr>
<tr>
<td>[].converter.pack-rules[]（可选）</td>
<td>消息打包规则，选择打包格式文件</td>
</tr>
<tr>
<td>[].converter.pack-rules[].predicate</td>
<td>断言规则，返回true选择当前规则rule作为打包格式文件，空条件为true，支持EL表达式</td>
</tr>
<tr>
<td>[].converter.pack-rules[].rule</td>
<td>消息格式文件，支持EL表达式</td>
</tr>
<tr>
<td>[].converter.unpack-rules[]（可选）</td>
<td>消息解包规则</td>
</tr>
<tr>
<td>[].converter.unpack-rules[].predicate</td>
<td>断言规则（同上）</td>
</tr>
<tr>
<td>[].converter.unpack-rules[].rule</td>
<td>消息格式文件（同上）</td>
</tr>
</tbody>
</table>
<p>消息转换类型，目前支持simple-json、simple-xml、velocity-json、velocity-xml、fixed-length、velocity-split、iso-8583等7种方式，这7种消息转换类型的说明和针对打包、解包规则说明如下：</p>
<table>
<thead>
<tr>
<th>消息转换类型</th>
<th>消息转换说明</th>
<th>消息转换描述</th>
<th>消息打包规则</th>
<th>消息解包规则</th>
</tr>
</thead>
<tbody>
<tr>
<td>simple-json</td>
<td>支持快速简单的JSON报文适配</td>
<td>打包：直接输出内部标准JSON报文</td>
<td></td>
<td></td>
</tr>
<tr>
<td>解包：直接对传入JSON进行解包</td>
<td>无</td>
<td>无</td>
<td></td>
<td></td>
</tr>
<tr>
<td>simple-xml</td>
<td>支持快速简单的XML报文适配</td>
<td>打包：直接把内部标准JSON报文转换成XML格式输出</td>
<td></td>
<td></td>
</tr>
<tr>
<td>解包：对传入XML直接解包成内部标准JSON报文</td>
<td>无</td>
<td>无</td>
<td></td>
<td></td>
</tr>
<tr>
<td>velocity-json</td>
<td>支持基于Velocity模板的JSON报文适配</td>
<td>打包：根据断言规则定位的Velocity模板文件进行打包</td>
<td></td>
<td></td>
</tr>
<tr>
<td>解包：直接对传入JSON进行解包</td>
<td>有</td>
<td>无</td>
<td></td>
<td></td>
</tr>
<tr>
<td>velocity-xml</td>
<td>支持基于Velocity模板的XML报文适配</td>
<td>打包：根据断言规则定位的Velocity模板文件，进行打包</td>
<td></td>
<td></td>
</tr>
<tr>
<td>解包：对传入XML直接解包成内部标准JSON报文</td>
<td>有</td>
<td>无</td>
<td></td>
<td></td>
</tr>
<tr>
<td>fixed-length</td>
<td>支持基于配置的定长报文适配</td>
<td>打包：根据断言规则定位的打包文件，文件是基于域级打包配置参数定制的</td>
<td></td>
<td></td>
</tr>
<tr>
<td>解包：基于预解包域级配置，并根据断言规则 定位的解包文件，文件是基于域级配置参数配置的</td>
<td>有</td>
<td>有</td>
<td></td>
<td></td>
</tr>
<tr>
<td>velocity-split</td>
<td>支持基于配置和Velocity模板的有分隔符报文适配</td>
<td>打包：根据断言规则定位的Velocity模板文件进行打包</td>
<td></td>
<td></td>
</tr>
<tr>
<td>解包：基于多级分隔符配置的解包</td>
<td>有</td>
<td>无</td>
<td></td>
<td></td>
</tr>
<tr>
<td>iso-8583</td>
<td>支持基于配置的ISO8583报文适配</td>
<td>打包：根据sink.yml中的fields、destination-id、source-id配置进行打包；</td>
<td></td>
<td></td>
</tr>
<tr>
<td>解包：根据sink.yml中的fields配置进行解包</td>
<td>无</td>
<td>无</td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<h3 id="2-converter目录">2 converter目录</h3>
<p>“config/converter”目录，存放了各种消息的格式转换配置文件，目前支持的文件类型有“<em>.vm”和“</em>.yml”。
对于消息格式转换类型有打包和解包规则 的，会根据断言规则定位，到message目录下用对应的文件来加载对应的格式转换配置，如下例所示：</p>
<pre><code class="language-shell">config/converter
├── server3
│   ├── error.vm
│   ├── man.vm
│   └── woman.vm
├── server4
│   ├── man.yml
│   └── woman.yml
└── server5
    ├── error.vm
    ├── man.vm
    └── woman.vm
</code></pre>
<p>文件类型和消息转换类型的关系如下：</p>
<ul>
<li>*.vm：Velocity模板文件
<ul>
<li>velocity-json消息转换类型中的打包模板</li>
<li>velocity-xml消息转换类型中的打包模板</li>
<li>velocity-split消息转换类型中的打包模板</li>
</ul>
</li>
<li>*.yml：YML配置文件
<ul>
<li>fix-length消息转换类型中的打包和解包参数配置文件</li>
</ul>
</li>
</ul>
<h4 id="21-velocity-jsonvelocity-xmlvm">2.1 velocity-json/velocity-xml（*.vm）</h4>
<p>对于消息转换类型为velocity-json、velocity-xml的，会根据断言规则定位，到converter目录下用对应的vm文件进行消息打包，如下例所示：</p>
<pre><code>config
|____converter
| |____sink4
| | |____woman.vm
| | |____error.vm
| | |____man.vm
</code></pre>
<p>vm文件支持velocity模板语言进行处理，模板中注入变量有：</p>
<table>
<thead>
<tr>
<th>变量名</th>
<th>变量说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>data</td>
<td>BizMessage.data：内部标准消息的数据体，为JSONObject对象格式</td>
</tr>
</tbody>
</table>
<h4 id="22-fixed-lengthyml">2.2 fixed-length(*.yml）</h4>
<p>对于消息转换类型为fixed-length，会根据断言规则 定位，到converter目录下用对应的yml文件进行打包和解包，如下例所示：</p>
<pre><code>config
|____converter
| |____sink6
| | |____woman.yml
| | |____error.yml
| | |____man.yml
</code></pre>
<p>yml配置文件如下例所示：</p>
<pre><code class="language-yaml">- name: sex
  length: 1
- name: accountNo
  length: 8
  unpack-functions:
    - name: trim
- name: accountName
  length: 10
  unpack-functions:
    - name: trim
- name: balance
  length: 10
  pack-functions:
    - name: decimalFormat
      args:
        - &quot;###,###.00&quot;
</code></pre>
<p>相关配置域属性如下：</p>
<table>
<thead>
<tr>
<th>配置域</th>
<th>域说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>name</td>
<td>对应内部标准消息格式中的JSON域名。</td>
</tr>
<tr>
<td>length</td>
<td>域值所占长度</td>
</tr>
<tr>
<td>unpack-functions</td>
<td>解包函数，支持多个函数，多个函数会按序执行。</td>
</tr>
<tr>
<td>pack-functions</td>
<td>打包函数，同样支持多个函数</td>
</tr>
</tbody>
</table>
<h3 id="3-converter介绍">3 Converter介绍</h3>
<h4 id="31-simple-json简单json格式适配">3.1 simple-json（简单JSON格式适配）</h4>
<p>支持快速、简单的JSON消息适配，直接把Biz-SIP内部标准消息，直接打包成外部的JSON格式；同时也直接把外部的JSON格式消息，快速直接解包成Biz-SIP内部标准消息。
可以在客户端适配器和服务端适配器中启用，配置如下例所示：</p>
<pre><code class="language-yaml">- id: sink1
  type: rest
  url: http://bizsip-sample-sink/sink1
  converter:
    type: simple-json
  connector:
    type: sink-bean
    class-name: com.bizmda.bizsip.sample.sink.controller.CrmServer
</code></pre>
<h4 id="32-simple-xml简单xml格式适配">3.2 simple-xml（简单XML格式适配）</h4>
<p>支持快速、简单的XML消息适配，直接把Biz-SIP内部标准消息，直接打包成外部的XML格式；同时也直接把外部的XML格式消息，快速直接解包成Biz-SIP内部标准消息。
可以在客户端适配器和服务端适配器中启用，配置如下例所示：</p>
<pre><code class="language-yaml">- id: server3
  type: rest
  url: http://sip-sample-server/server3
  converter:
    type: simple-xml
  connector:
    type: sink-bean
    class-name: com.bizmda.bizsip.sample.sink.controller.EchoServer
</code></pre>
<h4 id="33-velocity-json基于模板的json格式适配">3.3 velocity-json（基于模板的JSON格式适配）</h4>
<p>支持基于Velocity模板的JSON报文适配，在对外部的JSON报文打包，是采用Velocity模板文件，这个文件是通过打包断言规则来进行匹配的；外部JSON报文的解包，是直接解包成Biz-SIP内部标准消息的。
配置如下例所示，含有pack-rules：</p>
<pre><code class="language-yaml">- id: server4
  type: rest
  url: http://sip-sample-server/server4
  converter:
    type: velocity-json
    pack-rules:
      - predicate: '#{#data[sex]==&quot;0&quot;}'
        rule: server3/woman.vm
      - predicate: '#{#data[sex]==&quot;1&quot;}'
        rule: server3/man.vm
      - predicate:
        rule: server3/error.vm
  connector:
    type: sink-bean
    class-name: com.bizmda.bizsip.sample.sink.controller.EchoServer
</code></pre>
<p>Velocity模板中注入变量有：</p>
<table>
<thead>
<tr>
<th>变量名</th>
<th>变量说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>data</td>
<td>BizMessage.data：内部标准消息的数据体，为JSONObject对象格式</td>
</tr>
</tbody>
</table>
<h4 id="34-velocity-xml基于模板的xml适配">3.4 velocity-xml（基于模板的XML适配）</h4>
<p>支持基于Velocity模板的XML报文适配，在对外部的XML报文打包，是采用Velocity模板文件，这个文件是通过打包断言规则来进行匹配的；外部XML报文的解包，是直接解包成Biz-SIP内部标准消息的。
配置如下例所示，含有pack-rules：</p>
<pre><code class="language-yaml">- id: server5
  type: rest
  url: http://sip-sample-server/server5
  converter:
    type: velocity-xml
    pack-rules:
      - predicate: '#{#data[sex]==&quot;0&quot;}'
        rule: server3/woman.vm
      - predicate: '#{#data[sex]==&quot;1&quot;}'
        rule: server3/man.vm
      - predicate:
        rule: server3/error.vm
    unpack-rules:
  connector:
    type: sink-bean
    class-name: com.bizmda.bizsip.sample.sink.controller.EchoServer
</code></pre>
<p>Velocity模板中注入变量有：</p>
<table>
<thead>
<tr>
<th>变量名</th>
<th>变量说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>data</td>
<td>BizMessage.data：内部标准消息的数据体，为JSONObject对象格式</td>
</tr>
</tbody>
</table>
<h4 id="35-fixed-length定长消息适配">3.5 fixed-length（定长消息适配）</h4>
<p>支持基于配置的定长报文适配：</p>
<ul>
<li>打包：根据断言规则定位的打包文件，文件是基于域级打包配置参数定制的</li>
<li>解包：先基于域级配置进行消息报文的预解包，并根据断言规则 定位的解包文件，文件是基于域级配置参数配置的。</li>
</ul>
<p>配置如下例所示，含有pre-unpack、pack-rules和unpack-rules：</p>
<pre><code class="language-yaml">- id: server6
  type: rest
  url: http://sip-sample-server/server6
  converter:
    type: fixed-length
    pre-unpack:
      - name: sex
        length: 1
        functions:
          - name: trim
    pack-rules:
      - predicate: '#{#data[sex]==&quot;0&quot;}'
        rule: server4/woman.yml
      - predicate: '#{#data[sex]==&quot;1&quot;}'
        rule: server4/man.yml
      - predicate:
        rule: server4/error.yml
    unpack-rules:
      - predicate: '#{#data[sex]==&quot;0&quot;}'
        rule: server4/woman.yml
      - predicate: '#{#data[sex]==&quot;1&quot;}'
        rule: server4/man.yml
      - predicate:
        rule: server4/error.yml
  connector:
    type: sink-bean
    class-name: com.bizmda.bizsip.sample.sink.controller.EchoServer
</code></pre>
<p>根据解包和打包断言规则，定位报文对应的解包或打包定义yml定义文件，解包和打包定义文件如下例所示：</p>
<pre><code class="language-yaml">- name: sex
  length: 1
- name: accountNo
  length: 8
  unpack-functions:
    - name: trim
- name: accountName
  length: 10
  unpack-functions:
    - name: trim
- name: balance
  length: 10
  pack-functions:
    - name: decimalFormat
      args:
        - &quot;###,###.00&quot;
</code></pre>
<p>主要的配置定义如下：</p>
<table>
<thead>
<tr>
<th>配置项</th>
<th>配置说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>[].name</td>
<td>域名，对应Biz-SIP内部标准消息中的域名。</td>
</tr>
<tr>
<td>解包：表示当前数据从些域名中取得数据；</td>
<td></td>
</tr>
<tr>
<td>打包：表示数据对置入该域名对应的数据域。</td>
<td></td>
</tr>
<tr>
<td>[].length</td>
<td>当前域的长度</td>
</tr>
<tr>
<td>[].unpack-functions[]（可选）</td>
<td>解包时，对当前域域值进行处理的域处理函数。</td>
</tr>
<tr>
<td>[].pack-functions[]（可选）</td>
<td>打包时，对当前域域值进行处理的域处理函数。</td>
</tr>
</tbody>
</table>
<p>其中，unpack-functions、pack-functions，以及pre-unpack项下的functions，都是域处理函数，具体请参见“6.4 域处理函数”一节，相关配置定义如下：</p>
<table>
<thead>
<tr>
<th>配置项</th>
<th>配置说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>name</td>
<td>域处理函数，具体请参见域处理函数一节</td>
</tr>
<tr>
<td>args[]</td>
<td>域处理函数的参数，具体参数约定请参见域处理函数一节。</td>
</tr>
</tbody>
</table>
<p>fixed-length格式转换的解包流程为：</p>
<ol>
<li>根据“pre-unpack”中的设置，首先对传入的定长消息进行预解包，先解出关键域的域值；</li>
<li>根据“unpack-rule”，用上一步解出的关键域域值，根据解包断言规则，选择指定的解包yml定义文件；</li>
<li>根据上一步选择的解包yml定义文件，对传入的定长消息进行解包，解包成Biz-SIP内部标准消息。</li>
</ol>
<p>打包流程为：</p>
<ol>
<li>根据“pack-rule”，根据打包断言规则，选择指定的打包yml定义文件；</li>
<li>根据上一步选择的打包yml定义文件，对Biz-SIP内部标准消息进行打包，打包成定长消息报文。</li>
</ol>
<h4 id="36-velocity-split基于模板的有分隔符消息适配">3.6 velocity-split（基于模板的有分隔符消息适配）</h4>
<p>velocity-split消息适配，是针对有分隔符消息的转换和适配，打包是基于Velocity模板方式来进行转换的，解包是基于客户端适配器和服务端适配器的消息配置来转换的。
velocity-split消息适配的打包，是支持基于Velocity模板的适配，模板文件是通过打包断言规则来进行匹配的。
source.yml/sink.yml文件的配置如下例所示，含有separators和pack-rules的定义：</p>
<pre><code class="language-yaml">- id: server7
  type: rest
  url: http://sip-sample-server/server7
  converter:
    type: velocity-split
    separators:
      - &quot;*&quot;
      - &quot;,&quot;
    pack-rules:
      - predicate: '#{#data[sex]==&quot;0&quot;}'
        rule: server5/woman.vm
      - predicate: '#{#data[sex]==&quot;1&quot;}'
        rule: server5/man.vm
      - predicate:
        rule: server5/error.vm
  connector:
    type: sink-bean
    class-name: com.bizmda.bizsip.sample.sink.controller.EchoServer
</code></pre>
<p>主要的配置定义如下：</p>
<table>
<thead>
<tr>
<th>配置项</th>
<th>配置说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>[].converter.separators</td>
<td></td>
</tr>
<tr>
<td>约定分隔符，可以设置多个分隔符。</td>
<td></td>
</tr>
</tbody>
</table>
<p>velocity-split格式转换的打包流程为：</p>
<ol>
<li>根据“pack-rule”，执行打包断言规则，选择指定的打包vm定义文件；</li>
<li>根据上一步选择的解包yml定义文件，对Biz-SIP内部标准消息进行打包，打包成有分隔符消息报文。</li>
</ol>
<p>解包流程为：</p>
<ol>
<li>根据“unpack-rule”，根据打包断言规则，选择指定的打包yml定义文件；</li>
<li>根据source.yml/sink.yml文件中的separators设置，将有分隔符消息报文，直接解包到Biz-SIP内部标准消息报文。</li>
</ol>
<h4 id="37-iso-8583iso8583消息适配">3.7 iso-8583（ISO8583消息适配）</h4>
<p>支持基于配置的ISO8583消息适配，打包和解包，都是根据sink.yml文件中对应sink的iso-8583报文和域配置信息，进行ISO8583报文的打包和解包。
sink.yml对应ISO8583报文配置，如下例所示：</p>
<pre><code class="language-yaml">- id: sink13
  type: rest
  url: http://bizsip-sample-sink/sink13
  converter:
    type: iso-8583
    destination-id: '00010344'
    source-id: '42430440'
    fields:
      - index: 2
        length: 19
        unfixed: 2
        name: accNo2
      - index: 3
        length: 6
        name: processingCode3
      - index: 4
        length: 12
        name: amt_trans4
      - index: 5
        length: 12
        name: amt_settlmt5
      - index: 6
        length: 12
        name: transactionAmount6
      - index: 7
        length: 10
        name: transmsn_date_time7
      - index: 9
        length: 8
        name: transmsn_date_time9
      - index: 10
        length: 8
        name: transmsn_date_time10
      - index: 11
        length: 6
        name: systemTraceAuditNumber11
      - index: 12
        length: 6
        name: time_local_trans12
      - index: 13
        length: 4
        name: date_local_trans13
      - index: 14
        length: 4
        name: date_expr14
      - index: 15
        length: 4
        name: date_settlmt15
      - index: 16
        length: 4
        name: date_conv16
      - index: 18
        length: 4
        name: mchnt_type18
      - index: 19
        length: 3
        name: mchnt_cntry_code19
      - index: 22
        length: 3
        name: pos_entry_mode_code22
      - index: 23
        length: 3
        name: card_seq_num23
      - index: 25
        length: 2
        name: pos_cond_code25
      - index: 26
        length: 2
        name: pos_pin_cap_code26
      - index: 28
        length: 9
        name: amt_fee28
      - index: 32
        length: 11
        unfixed: 2
        name: acq_inst_id_code32
      - index: 33
        length: 11
        unfixed: 2
        name: fwd_inst_id_code33
      - index: 35
        length: 37
        unfixed: 2
        name: track2_data35
      - index: 36
        length: 104
        unfixed: 3
        name: track3_data36
      - index: 37
        length: 12
        name: retrivl_ref_num37
      - index: 38
        length: 6
        name: authr_id_resp38
      - index: 39
        length: 2
        name: resp_code39
      - index: 41
        length: 8
        name: card_accptr_termnl_id41
      - index: 42
        length: 15
        name: card_accptr_id42
      - index: 43
        length: 40
        name: card_accptr_name_loc43
      - index: 44
        length: 25
        unfixed: 2
        name: addtnl_resp_code44
      - index: 45
        length: 76
        unfixed: 2
        name: track1_data45
      - index: 48
        length: 512
        unfixed: 3
        name: addtnl_data_private48
      - index: 49
        length: 3
        name: currcy_code_trans49
      - index: 50
        length: 3
        name: currcy_code_settlmt50
      - index: 51
        length: 3
        name: currcy_code_cdhldr_bil51
      - index: 52
        length: 8
        name: pin_data52
      - index: 53
        length: 16
        name: security_control_info53
      - index: 54
        length: 40
        unfixed: 3
        name: addtnl_amt54
      - index: 55
        length: 255
        unfixed: 3
        name: ICC_data55
      - index: 56
        length: 255
        unfixed: 3
        name: token_par56
      - index: 57
        length: 100
        unfixed: 3
        name: issr_addtnl_data57
      - index: 59
        length: 600
        unfixed: 3
        name: detai_inquiring59
      - index: 60
        length: 100
        unfixed: 3
        name: reserved60
      - index: 61
        length: 200
        unfixed: 3
        name: ch_auth_info61
      - index: 62
        length: 200
        unfixed: 3
        name: switching_data62
      - index: 63
        length: 512
        unfixed: 3
        name: fin_net_data63
      - index: 70
        length: 3
        name: net_mgr_info_code70
      - index: 90
        length: 42
        name: ori_data_element90
      - index: 96
        length: 8
        name: msg_security_code96
      - index: 100
        length: 11
        unfixed: 2
        name: rcvg_inst_id_code100
      - index: 102
        length: 28
        unfixed: 2
        name: acct_id_1_102
      - index: 103
        length: 28
        unfixed: 2
        name: acct_id_2_103
      - index: 104
        length: 512
        unfixed: 3
        name: trans_industry_app_inf104
      - index: 113
        length: 512
        unfixed: 3
        name: add_data113
      - index: 117
        length: 256
        unfixed: 3
        name: addtnl_data117
      - index: 121
        length: 100
        unfixed: 3
        name: national_sw_resved121
      - index: 122
        length: 100
        unfixed: 3
        name: acq_inst_resvd122
      - index: 123
        length: 100
        unfixed: 3
        name: issr_inst_resvd123
      - index: 125
        length: 256
        unfixed: 3
        name: addtnl_data125
      - index: 128
        length: 8
        name: msg_authn_code128
  connector:
    type: sink-bean
    class-name: com.bizmda.bizsip.sample.sink.controller.EchoServer
</code></pre>
<p>主要的配置定义如下：</p>
<table>
<thead>
<tr>
<th>配置项</th>
<th>配置说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>[].type</td>
<td>约定为“iso-8583”</td>
</tr>
<tr>
<td>[].destination-id</td>
<td>配置ISO8583报文中的目的ID</td>
</tr>
<tr>
<td>[].source-id</td>
<td>配置ISO8583报文中的源ID</td>
</tr>
<tr>
<td>[].fields</td>
<td>ISO8583中各域的配置</td>
</tr>
<tr>
<td>[].fields[].index</td>
<td>对应ISO8583报文中的域索引号。</td>
</tr>
<tr>
<td>0：报文头，缺省域名为“msgHead”</td>
<td></td>
</tr>
<tr>
<td>1：报文类型标识，缺省域名为“msgType”</td>
<td></td>
</tr>
<tr>
<td>2&hellip;128：ISO8583域</td>
<td></td>
</tr>
<tr>
<td>[].fields[].name</td>
<td>域名，主要在生成的JSON报文中用，报文头、报文类型标识缺省为msgHead、msgType，2&hellip;128域缺省为f2&hellip;f128</td>
</tr>
<tr>
<td>[].fields[].length</td>
<td>域长度，可变长度域为最大域长度</td>
</tr>
<tr>
<td>[].fields[].unfixed</td>
<td>可变长度域类型，可以取值为2和3，代表长度位分别是2位和3位；如果不配置则为定长域。</td>
</tr>
</tbody>
</table>
<h3 id="4-域处理函数">4 域处理函数</h3>
<p>域处理函数可以用在以下几个地方：</p>
<ol>
<li>预解包：一般定义在source.yml/sink.yml文件中的pre-unpack设置下的functions；</li>
<li>解包：一般定义在解包yml文件中的unpack-functions；</li>
<li>打包：一般定义在打包yml文件中的pack-functions。</li>
</ol>
<p>支持的域处理函数如下（可以自行扩展）：</p>
<table>
<thead>
<tr>
<th>域处理函数名</th>
<th>说明</th>
<th>参数</th>
</tr>
</thead>
<tbody>
<tr>
<td>fill</td>
<td>填充</td>
<td>参数1（必选）：填充方式，left/right分别代表左填充和右填充</td>
</tr>
<tr>
<td>参数2（必选）：填充字符</td>
<td></td>
<td></td>
</tr>
<tr>
<td>参数3（可选）：填充长度，缺省为当前域长度</td>
<td></td>
<td></td>
</tr>
<tr>
<td>trim</td>
<td>去除空格</td>
<td>参数1（可选）：left/right分别代表去左边空格和去右边空格，缺省为左右空格都去掉。</td>
</tr>
<tr>
<td>decimalFormat</td>
<td>对数字进行格式化</td>
<td>参数1（必选）：根据Java中的DecimalFormat类格式，对数字进行格式化</td>
</tr>
</tbody>
</table>
<h2 id="六领域层sink-connector配置通讯适配">六、领域层sink connector配置（通讯适配）</h2>
<h3 id="1-sink-bean-connector">1 Sink-Bean Connector</h3>
<p>相关配置参数：</p>
<table>
<thead>
<tr>
<th>配置项</th>
<th>配置说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>[].connector.type</td>
<td>约定为“sink-bean”</td>
</tr>
<tr>
<td>[].connector.class-name</td>
<td>约定调用的java类</td>
</tr>
<tr>
<td>[].connector.spring-bean</td>
<td>约定是否调用的是Spring容器Bean（缺省是非Spring容器Bean）</td>
</tr>
</tbody>
</table>
<p>例子：</p>
<pre><code class="language-yaml">- id: server1
  type: rest
  url: http://sip-sample-server/server1
  converter:
    type: simple-json
  connector:
    type: sink-bean
    class-name: com.bizmda.bizsip.sample.sink.controller.CrmServer
</code></pre>
<p>Sink-Bean Connector相关类，需要从以下接口来继续实现，一般开发人员会根据传入的参数，选择继承不同的接口：</p>
<ul>
<li>采用Biz-SIP标准的JSONObject来做入参、出参，一般是开发纯粹做交易处理的模块，可以开发并实现JSONObjectSinkBeanInterface接口的类，并挂接到Sink-Bean Connector上，JSONObjectSinkBeanInterface接口约定如下：</li>
</ul>
<pre><code class="language-java">public interface JSONObjectSinkBeanInterface {
    /**
     * JSONObject SinkBean服务调用接口
     * @param packMessage 传入的消息
     * @return 返回值
     * @throws BizException
     */
    public JSONObject process(JSONObject packMessage) throws BizException;
}
</code></pre>
<ul>
<li>采用字节流byte[]来做入参、出参，一般是涉及到不同消息类型的转换，可以开发并实现SinkBeanInterface接口的类，并挂接到Sink-Bean Connector上，SinkBeanInterface接口约定如下：</li>
</ul>
<pre><code class="language-java">public interface SinkBeanInterface {
    /**
     * Java服务调用接口
     * @param beforeJsonObject 打包前的JsonObject
     * @param packMessage 传入的消息
     * @return 返回值
     * @throws BizException
     */
    public byte[] process(JSONObject beforeJsonObject, byte[] packMessage) throws BizException;
}
</code></pre>
<p>另外，如果要在process()前后，以及异常时做些个性化的开发切面，可以再加上SinkBeanAspectInterface接口的实现：</p>
<pre><code class="language-java">public interface SinkBeanAspectInterface {
    /**
     *
     * @param jsonObject 一般为convertor处理前传入的JSONObject
     * @return 经过处理后的JSONObject
     */
    public JSONObject beforeProcess(JSONObject jsonObject);

    /**
     *
     * @param beforeJsonObject 一般为convertor处理前传入的JSONObject
     * @param afterJsonObject 经过process()处理后返回的JSONObject
     * @return
     */
    public JSONObject afterProcess(JSONObject beforeJsonObject,JSONObject afterJsonObject);

    /**
     *
     * @param jsonObject 传入process()的JSONObject
     * @param bizException 在process()中抛出的异常
     */
    public void handleProcessException(JSONObject jsonObject,BizException bizException);
}
</code></pre>
<h3 id="2-bean-connector">2 Bean Connector</h3>
<p>Bean Connector能根据sink.yaml和传入数据中包含的约定参数，调用约定的Java类名方法名。
在服务编排脚本中，是通过传入JSON数据中的className、methodName、params，来分别约定调用的Java类外、方法名、参数列表，如果在sink.yml中配置了className和methodName，则以sink.yml中的配置为准，如下例：</p>
<pre><code class="language-javascript">var data = {
    methodName: &quot;getCustomerList&quot;
};
var result = sip.callSink(&quot;sink11&quot;,data);

data = {
    methodName: &quot;saveCustomerDto&quot;,
    params: [&quot;004&quot;,&quot;赵六&quot;]
};
var result = sip.callSink(&quot;sink11&quot;,data);

data = {
    methodName: &quot;getName&quot;,
    params: &quot;005&quot;
};
var result = sip.callSink(&quot;sink11&quot;,data);

data = {
    methodName: &quot;getAge&quot;,
    params: &quot;005&quot;
};
var result = sip.callSink(&quot;sink11&quot;,data);

return result;
</code></pre>
<p>这里有二点需要注意：</p>
<ul>
<li>所对应的Sink，要求配置的converter一定是“simple-json”类型，其它类型的converter不支持。</li>
<li>调用Sink后返回的结果，是用“result”作为根节点的JSON报文，如下所示：</li>
</ul>
<pre><code class="language-json">&quot;result&quot;: [
        {
            &quot;sex&quot;: &quot;1&quot;,
            &quot;customerId&quot;: &quot;001&quot;,
            &quot;name&quot;: &quot;张三&quot;,
            &quot;age&quot;: 20
        },
        {
            &quot;sex&quot;: &quot;0&quot;,
            &quot;customerId&quot;: &quot;001&quot;,
            &quot;name&quot;: &quot;李四&quot;,
            &quot;age&quot;: 30
        },
        {
            &quot;sex&quot;: &quot;1&quot;,
            &quot;customerId&quot;: &quot;001&quot;,
            &quot;name&quot;: &quot;王五&quot;,
            &quot;age&quot;: 40
        }
    ]
</code></pre>
<pre><code class="language-json">&quot;result&quot;: 30
</code></pre>
<p>对应的调用Java类，如下：</p>
<pre><code class="language-java">public class JavaApiBean {
    public CustomerDto[] getCustomerList() {
		......
    }

    public void saveCustomerDto(String customerId,String name) {
        ......
    }

    public String getName(String id) {
        ......
    }

    public int getAge(String id) {
        ......
    }
}
</code></pre>
<p>如果传入JSON数据中没有传入，则以sink.yaml中对应配置为准，相关配置参数：</p>
<table>
<thead>
<tr>
<th>配置项</th>
<th>配置说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>[].connector.type</td>
<td>约定为“bean”</td>
</tr>
<tr>
<td>[].connector.class-name</td>
<td>设置调用的java类（可选）</td>
</tr>
<tr>
<td>[].connector.method-name</td>
<td>设置调用的方法名（可选）</td>
</tr>
<tr>
<td>[].connector.spring-bean</td>
<td>约定是否调用的是Spring容器Bean（缺省是非Spring容器Bean）</td>
</tr>
</tbody>
</table>
<p>例子：</p>
<pre><code class="language-yaml">## 测试调用Java API的Sink
- id: sink11
  type: rest
  url: http://bizsip-sample-sink/sink11
  converter:
    type: simple-json
  connector:
    type: bean
    class-name: com.bizmda.bizsip.sample.sink.javaapi.JavaApiBean
    method-name: getAge
</code></pre>
<h3 id="3-netty-connector">3 Netty Connector</h3>
<p>相关配置参数：</p>
<table>
<thead>
<tr>
<th>配置项</th>
<th>配置说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>[].connector.type</td>
<td>约定为“netty”</td>
</tr>
<tr>
<td>[].connector.host</td>
<td>约定调用的TCP主机地址</td>
</tr>
<tr>
<td>[].connector.port</td>
<td>约定调用的TCP端口地址</td>
</tr>
</tbody>
</table>
<p>例子：</p>
<pre><code class="language-yaml">- id: netty-server
  type: rest
  url: http://sip-sample-server/netty
  converter:
    type: simple-json
  connector:
    type: netty
    host: 127.0.0.1
    port: 10002
</code></pre>
<h3 id="4-rabbitmq-connector">4 RabbitMQ Connector</h3>
<p>相关配置参数：</p>
<table>
<thead>
<tr>
<th>配置项</th>
<th>配置说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>[].connector.type</td>
<td>约定为“rabbitmq”</td>
</tr>
<tr>
<td>[].connector.route-key</td>
<td>投递消息时的Route Key</td>
</tr>
</tbody>
</table>
<p>例子：</p>
<pre><code class="language-yaml">- id: sink9
  type: rest
  url: http://bizsip-sample-sink/sink9
  converter:
    type: simple-json
  connector:
    type: rabbitmq
    route-key: sink9
</code></pre>
<h2 id="七典型source端适配器介绍与配置">七、典型Source端适配器介绍与配置</h2>
<p>对于一些常用的服务接入模式，提供了开箱即用的Source端适配器，可以直接拿来用，也可以在原有的基础上再做个性化改造。</p>
<h3 id="1-restful服务接入适配器">1 RESTful服务接入适配器</h3>
<p>RESTful服务接入适配器，是建立RESTful服务器来处理发来的RESTful消息，服务请求URL为“http://{地址}:{端口}/rest”，请求需要以“POST”方式来提交，适配器收到发来的消息后，会发给聚合服务整合器进行处理，并把处理结果同步返回给接入端。
客户端适配器代码放在“source/rest-source”模块中，启动运行程序为“RestSourceApplication.java”。
模块application.yml相关参数：</p>
<table>
<thead>
<tr>
<th>配置项</th>
<th>配置说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>bizsip.config-path</td>
<td>Biz-SIP中间件配置文件根目录位置</td>
</tr>
<tr>
<td>bizsip.integrator-url</td>
<td>服务聚合器的开放接口url地址</td>
</tr>
<tr>
<td>bizsip.source-id</td>
<td>客户端适配器ID，是在source.yml文件中定义的</td>
</tr>
</tbody>
</table>
<h3 id="2-netty-tcp服务接入适配器">2 Netty TCP服务接入适配器</h3>
<p>Netty TCP服务接入适配器，是建立一个Netty服务器来侦听指定的端口，收到发来的TCP报文后，会发给聚合服务整合器进行处理，并把处理结果同步返回给接入端，可以支持Biz-SIP所有已支持的消息报文类型。
客户端适配器代码放在“source/netty-source”模块中，启动运行程序为“NettySourceApplication.java”。
模块application.yml相关参数：</p>
<table>
<thead>
<tr>
<th>配置项</th>
<th>配置说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>bizsip.config-path</td>
<td>Biz-SIP中间件配置文件根目录位置</td>
</tr>
<tr>
<td>bizsip.integrator-url</td>
<td>服务聚合器的开放接口url地址</td>
</tr>
<tr>
<td>bizsip.source-id</td>
<td>客户端适配器ID，是在source.yml文件中定义的</td>
</tr>
<tr>
<td>netty.port</td>
<td>定义Netty TCP服务的侦听端口</td>
</tr>
</tbody>
</table>
<p>相关测试案例可以参见sample8。</p>
<h2 id="八服务校验规则">八、服务校验规则</h2>
<p>Biz-SIP中间件支持服务消息域校验规则和服务阻断校验规则，服务消息域校验规则能对上送域的域值进行合法性检验，对于不符合检验规则的消息，会直接在入口处拒绝。服务阻断检验规则能对服务上送数据进行检查，对不符合规则的服务，也会在入口处拒绝，类似于服务的风控系统。
服务检验规则，是配置在config/check-rule目录下，配置文件的目录和文件名和对应的服务脚本位置应一致，配置文件后缀为“.yml”，配置相关参数：</p>
<table>
<thead>
<tr>
<th>配置项</th>
<th>配置说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>field-check-rules</td>
<td>定义域校验规则</td>
</tr>
<tr>
<td>field-check-rules.[].field</td>
<td>域的JSON取值Path，例如email、account[1].balance</td>
</tr>
<tr>
<td>field-check-rules.[].rule</td>
<td>域校验规则，具体参见域校验规则一节</td>
</tr>
<tr>
<td>field-check-rules.[].args[]</td>
<td>域检验规则的参数，具体参见域检验规则一节</td>
</tr>
<tr>
<td>field-check-rules.[].message</td>
<td>检验出错后，显示给调用方的错误消息。message可以嵌入域值，例如“不是邮箱地址:{}”。</td>
</tr>
<tr>
<td>field-check-mode</td>
<td>域检验模式，主要有“one”和“all”这二种模式，“one”表示有一个域不满足，即返回错误，返回的错误只包括第一个不满足的原因信息；“all”表示返回错误会包括所有不满足的原因信息。</td>
</tr>
<tr>
<td>service-check-rules</td>
<td>定义服务校验规则</td>
</tr>
<tr>
<td>service-check-rules.[].script</td>
<td>服务检验脚本</td>
</tr>
<tr>
<td>service-check-rules.[].message</td>
<td>检验出错后，显示给调用方的错误消息。</td>
</tr>
<tr>
<td>service-check-mode</td>
<td>服务校验模式，主要有“one”和“all”这二种模式，“one”表示有一个域不满足，即返回错误，返回的错误只包括第一个不满足的原因信息；“all”表示返回错误会包括所有不满足的原因信息。</td>
</tr>
</tbody>
</table>
<p>具体案例如下：
config/check-rule/openapi/sample1.yml</p>
<pre><code class="language-yaml">field-check-rules:
  - field: email
    rule: isEmail
    message: '不是邮箱地址:{}'
  - field: sex
    rule: notEmpty
    message: '不能为空'
  - field: mobile
    rule: isMatchRegex
    args:
      - '^[1][3,4,5,6,7,8,9][0-9]{9}$'
    message: '不是手机号{}'
field-check-mode: one
service-check-rules:
  - script: if(data.sex == '1')
            {return '性别不符合!';}
    message: '额度超限'
service-check-mode: one
</code></pre>
<p>域检验规则：</p>
<table>
<thead>
<tr>
<th>域校验规则</th>
<th>说明</th>
<th>参数</th>
</tr>
</thead>
<tbody>
<tr>
<td>isCitizenId</td>
<td>验证是否为身份证号码（支持18位、15位和港澳台的10位）</td>
<td>（无）</td>
</tr>
<tr>
<td>isEmail</td>
<td>验证是否为可用邮箱地址</td>
<td>（无）</td>
</tr>
<tr>
<td>notEmpty</td>
<td>验证是否为空</td>
<td>（无）</td>
</tr>
<tr>
<td>isMatchRegex</td>
<td>通过正则表达式验证</td>
<td>参数1：正则表达式</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
          </div>

          



          
          
          <div class="article-widget">
            
<div class="post-nav">
  
  
  
  <div class="post-nav-item">
    <div class="meta-nav">上一页</div>
    <a href="/doc/quick-start/" rel="next">快速启动</a>
  </div>
  
  
  
  <div class="post-nav-item">
    <div class="meta-nav">下一页</div>
    <a href="/doc/development/" rel="prev">系统开发</a>
  </div>
  
</div>

          </div>
          
        </div>

        <div class="body-footer">
          <p>最近更新于 Sep 24, 2021</p>

          



          




          




        </div>

      </article>

      <footer class="site-footer">

  

  

  
  <p class="powered-by">
    © 2020-2021 BIZMDA.com版权所有 <a href="http://beian.miit.gov.cn">沪ICP备2021002172号</a>
  </p>
  

  
  






  <p class="powered-by">
    
    
    
      
      
      
      
      
      
      由<a href="https://wowchemy.com/?utm_campaign=poweredby" target="_blank" rel="noopener">Wowchemy</a>支持发布——免费<a href="https://github.com/wowchemy/wowchemy-hugo-modules" target="_blank" rel="noopener">开源</a>网站，为创作者赋能。
    
  </p>
</footer>


    </main>
  </div>
</div>

  </div>

  <div class="page-footer">
    
    
  </div>

  
<div id="modal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">引用</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <pre><code class="tex hljs"></code></pre>
      </div>
      <div class="modal-footer">
        <a class="btn btn-outline-primary my-1 js-copy-cite" href="#" target="_blank">
          <i class="fas fa-copy"></i> 复制
        </a>
        <a class="btn btn-outline-primary my-1 js-download-cite" href="#" target="_blank">
          <i class="fas fa-download"></i> 下载
        </a>
        <div id="modal-error"></div>
      </div>
    </div>
  </div>
</div>

      

    
    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/instant.page/5.1.0/instantpage.min.js" integrity="sha512-1+qUtKoh9XZW7j+6LhRMAyOrgSQKenQ4mluTR+cvxXjP1Z54RxZuzstR/H9kgPXQsVB8IW7DMDFUJpzLjvhGSQ==" crossorigin="anonymous"></script>

      
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.4/imagesloaded.pkgd.min.js" integrity="sha256-lqvxZrPLtfffUl2G/e7szqSvPBILGbwmsGE1MKlOi0Q=" crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.6/isotope.pkgd.min.js" integrity="sha256-CBrpuqrMhXwcLLUd5tvQ4euBHCdh7wGlDfNz8vbu/iI=" crossorigin="anonymous"></script>
      

      
      

      

      
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/highlight.min.js" integrity="sha512-TDKKr+IvoqZnPzc3l35hdjpHD0m+b2EC2SrLEgKDRWpxf2rFCxemkgvJ5kfU48ip+Y+m2XVKyOCD85ybtlZDmw==" crossorigin="anonymous"></script>
        
      

    

    
    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/leaflet.min.js" integrity="sha512-SeiQaaDh73yrb56sTW/RgVdi/mMqNeM2oBwubFHagc5BkixSpP1fvqF47mKzPGWYSSy4RwbBunrJBQ4Co8fRWA==" crossorigin="anonymous"></script>
    

    
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/4.2.2/anchor.min.js" integrity="sha512-I7w3ZdSFzw5j3jU3ZkNikBNeIrl3i+hEuEdwNmqUJvwNcaBUNcijnP2gd9DtGlgVYDplfjGoD8vTNsID+lCjqg==" crossorigin="anonymous"></script>
    <script>
      anchors.add();
    </script>
    

    
    
    
      
      <script id="search-hit-fuse-template" type="text/x-template">
        <div class="search-hit" id="summary-{{key}}">
          <div class="search-hit-content">
            <div class="search-hit-name">
              <a href="{{relpermalink}}">{{title}}</a>
              <div class="article-metadata search-hit-type">{{type}}</div>
              <p class="search-hit-description">{{snippet}}</p>
            </div>
          </div>
        </div>
      </script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/3.2.1/fuse.min.js" integrity="sha256-VzgmKYmhsGNNN4Ph1kMW+BjoYJM2jV5i4IlFoeZA9XI=" crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script>
      
    

    
    

    
    
    
    

    
    <script src="/js/bootstrap.bundle.min.6aed84840afc03ab4d5750157f69c120.js"></script>

    
    
      
      
      
      
      
      
      
    

    
    
    
    
    
    
    
    
      
      
    
    
    <script src="/zh/js/wowchemy.min.c01dc0f474cb5aa17a63e06eb00111fe.js"></script>

    






</body>
</html>
